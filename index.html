<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <title>Rechentrainer</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" href="css/main.css">
    <script src="src/main.js"></script>
</head>
<body>

<div class="block">
    <div id="challengeContainer">
    </div>
    <input type="button" id="ok_btn" value="OK">
</div>

<div id="points">


</div>

<script>
    var trainer = new RechenTrainer(document.getElementById('challengeContainer'));
    var audio = new Audio();
    var points = 0;

    nextChallange();


    function evaluate() {

        removeListener();

        var passed = trainer.check();
        points += trainer.getPoints();
        if (points < 0) {
            points = 0;
        }

        document.getElementById('points').innerText = points + ' Punkte'

        if (passed) {
            audio.src = 'audio/correct.mp3';
            setTimeout(nextChallange, 1500);
        } else {
            audio.src = 'audio/wrong.mp3';
            setTimeout(nextTry, 1500);
        }
        audio.play();
    }

    function nextTry() {
        trainer.reset();
        setListener();
    }


    function nextChallange() {
        trainer.nextChallenge();
        setListener();
    }

    function setListener() {
        document.getElementById('ok_btn').addEventListener('click', evaluate);
        document.addEventListener('keydown', onEnterKey);
        document.getElementById('ok_btn').style.visibility = 'visible';
    }

    function removeListener() {
        document.getElementById('ok_btn').removeEventListener('click', evaluate);
        document.removeEventListener('keydown', onEnterKey);
        document.getElementById('ok_btn').style.visibility = 'hidden';
    }

    function onEnterKey(event) {
        if (event.which === 13) {
            event.preventDefault();
            evaluate();
        }
    }


</script>
</body>
</html>
